{% extends 'auth_layout.html' %}

{% block css %}
<style>
    html, body { height: 100%; margin: 0; }
    #app, .v-application, .v-application__wrap { min-height: 100vh; }
</style>
{% endblock %}

{% block content %}
    <div id="app">
        <v-container class="d-flex align-center justify-center" style="min-height: 100vh;">
            <div style="width: 100%; max-width: 380px;">

                <div class="text-center mb-8">
                    <div class="text-h5 font-weight-bold mb-1">ReadyKit</div>
                    <div class="text-body-2 text-medium-emphasis">Reset your password</div>
                </div>

                <v-form action="{{ url_for_security('forgot_password') }}" method="POST" id="forgotPasswordForm">
                    {{ forgot_password_form.hidden_tag() }}

                    <v-text-field label="Email" name="email" type="email" required class="mb-1"></v-text-field>

                    {% if forgot_password_form.errors %}
                    {% for k, err in forgot_password_form.errors.items() %}
                    <v-alert type="error" density="compact" class="mb-4">{{ err[0] }}</v-alert>
                    {% endfor %}
                    {% endif %}

                    <v-btn block color="primary" size="large" @click="submit" class="mb-4">Send Reset Instructions</v-btn>
                </v-form>

                <!-- Flash Messages -->
                <v-alert v-if="flashMessage" :type="flashType" density="compact" class="mb-4" closable @click:close="flashMessage = ''">
                    ${ flashMessage }
                </v-alert>

                <div class="text-center">
                    <a href="{{ url_for_security('login') }}" class="text-decoration-none text-caption">Back to login</a>
                </div>
            </div>
        </v-container>
    </div>
{% endblock %}

{% block js %}
<script>
    const { createApp } = Vue;
    const { createVuetify } = Vuetify;
    const vuetify = createVuetify(config.vuetifyConfig);

    const app = createApp({
        data() {
            return { flashMessage: '', flashType: 'info' };
        },
        methods: {
            submit() { document.getElementById('forgotPasswordForm').submit(); }
        },
        mounted() {
            {% for category, message in get_flashed_messages(with_categories=true) %}
            this.flashMessage = '{{ message }}';
            this.flashType = '{{ category }}' === 'error' ? 'error' : ('{{ category }}' === 'warning' ? 'warning' : 'info');
            {% endfor %}
        },
        delimiters: config.delimiters
    });

    app.use(vuetify).mount('#app');
</script>
{% endblock %}
