<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>ReadyKit - Production-Ready SaaS Template</title>
    <meta name="description" content="Multi-tenant SaaS starter template with Flask, Vue 3, and modern authentication">
    <meta name="author" content="ReadyKit">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="/static/img/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href="/static/css/vuetify.min.css">
    <link rel="stylesheet" href="/static/mdi/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@latest/tabler-icons.min.css">
    <link rel="stylesheet" href="/static/css/layout.css">
    <link rel="stylesheet" href="/static/css/app.css">

    {% block css %}{% endblock %}
</head>

<body class="{% block body_class %} {% endblock %}">
<v-app id="app" v-cloak>
    <v-layout class="rounded rounded-md">
        <v-app-bar color="white" density="comfortable" elevation="0" border="b">
            <v-app-bar-nav-icon @click="drawer = !drawer" class="d-md-none"></v-app-bar-nav-icon>

            <v-app-bar-title>
                <a href="/" class="text-decoration-none d-flex align-center">
                    <span class="text-h5 font-weight-bold">ReadyKit</span>
                </a>
            </v-app-bar-title>
            <v-spacer></v-spacer>

            {% if not current_user.is_authenticated %}
            <v-btn href="/login" variant="text" class="ml-2">Sign in</v-btn>
            {% endif %}
        </v-app-bar>

        <v-navigation-drawer v-model="drawer" width="240">
            {% if current_user.is_authenticated %}
            <!-- User Identity -->
            <a href="/settings/profile" class="d-block pa-4 pb-2 text-decoration-none" style="color: inherit;">
                <div class="d-flex align-center mb-1">
                    <v-avatar size="32" color="#E4E4E7" class="mr-2">
                        <span class="font-weight-bold text-caption" style="color: #52525B;">{{ current_user.name[:1].upper() if current_user.name else 'U' }}</span>
                    </v-avatar>
                    <div style="min-width: 0;">
                        <div class="text-body-2 font-weight-medium text-truncate">{{ current_user.name or 'User' }}</div>
                        <div class="text-caption text-medium-emphasis text-truncate">{{ current_user.email }}</div>
                    </div>
                </div>
            </a>

            <v-divider></v-divider>

            <!-- Navigation -->
            <v-list density="compact" nav class="py-2">
                {% set current_workspace = get_current_workspace() %}

                {% if current_user.is_superadmin %}
                <v-list-item href="/dashboard" title="Platform Overview" prepend-icon="mdi-view-dashboard-outline"></v-list-item>
                <v-list-item href="/users/" title="Users" prepend-icon="mdi-account-multiple-outline"></v-list-item>
                <v-list-item href="/activities/" title="Activity Log" prepend-icon="mdi-history"></v-list-item>
                {% endif %}

                {% if current_workspace %}
                    {% if current_user.is_superadmin %}
                    <v-divider class="my-1"></v-divider>
                    <div class="px-4 py-2 text-caption text-medium-emphasis text-truncate">{{ current_workspace.name }}</div>
                    {% endif %}

                    <v-list-item href="/workspace/" title="Home" prepend-icon="mdi-home-outline"></v-list-item>

                    {% if current_user.is_superadmin or current_user.get_workspace_role(current_workspace.id) == 'admin' %}
                    <v-list-item href="/workspace/team/" title="Team" prepend-icon="mdi-account-group-outline"></v-list-item>
                    {% endif %}

                    <v-list-item href="/workspace/keys/" title="API Keys" prepend-icon="mdi-key-outline"></v-list-item>
                    <v-list-item href="/workspace/settings/" title="Settings" prepend-icon="mdi-cog-outline"></v-list-item>

                    {% if current_user.get_workspaces()|length > 1 %}
                    <v-list-item href="/dashboard" title="Switch Workspace" prepend-icon="mdi-swap-horizontal"></v-list-item>
                    {% endif %}
                {% elif not current_user.is_superadmin %}
                    <v-list-item href="/dashboard" title="Dashboard" prepend-icon="mdi-view-dashboard-outline"></v-list-item>
                {% endif %}

                <v-divider class="my-1"></v-divider>
                <div class="px-4 py-2 text-caption text-medium-emphasis">Account</div>

                <v-list-item href="/settings/profile" title="Profile" prepend-icon="mdi-account-outline"></v-list-item>
                <v-list-item href="/settings/security" title="Security" prepend-icon="mdi-shield-lock-outline"></v-list-item>
            </v-list>

            <!-- Sign Out at bottom -->
            <template v-slot:append>
                {% if current_workspace and not current_workspace.is_pro and current_user.get_workspace_role(current_workspace.id) == 'admin' %}
                <div class="pa-3 pt-0">
                    <div class="pa-3" style="border: 1px solid #E4E4E7; border-radius: 8px;">
                        <div class="text-caption font-weight-medium mb-1">Free Plan</div>
                        <div class="text-caption text-medium-emphasis mb-2">Upgrade for full access</div>
                        <v-btn href="/workspace/upgrade" color="primary" size="small" block class="text-none">
                            Upgrade to Pro
                        </v-btn>
                    </div>
                </div>
                {% endif %}
                <div class="pa-3">
                    <v-btn href="/logout" variant="text" block class="text-none justify-start text-medium-emphasis" prepend-icon="mdi-logout" size="small">
                        Sign Out
                    </v-btn>
                </div>
            </template>

            {% else %}
            <!-- Unauthenticated -->
            <v-list density="compact" nav class="py-2">
                <v-list-item href="/login" title="Login" prepend-icon="mdi-login"></v-list-item>
                <v-list-item href="/register" title="Sign Up" prepend-icon="mdi-account-plus-outline"></v-list-item>
            </v-list>
            {% endif %}
        </v-navigation-drawer>


        <v-main class="d-flex align-center justify-center" style="min-height: 300px;">
            {% block content %}
            {% endblock %}
        </v-main>

        <!-- Footer Attribution -->
        <v-footer app class="text-center py-2 text-caption text-medium-emphasis">
            <v-container>
                Powered by <a href="https://github.com/level09/enferno" target="_blank" class="text-decoration-none">Enferno Framework</a>
            </v-container>
        </v-footer>
        
        <!-- Flash messages (plain HTML - renders before Vue mounts) -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div id="flash-messages" class="flash-container">
                {% for category, message in messages %}
                    <div class="flash-message {{ category if category in ['success', 'warning', 'error', 'info'] else 'primary' }}">
                        <span>{{ message }}</span>
                        <button class="flash-close" onclick="this.parentElement.remove()">&times;</button>
                    </div>
                {% endfor %}
            </div>

            <script>
                // Auto-hide flash messages after 5 seconds
                setTimeout(function() {
                    const flashMessages = document.getElementById('flash-messages');
                    if (flashMessages) {
                        flashMessages.style.display = 'none';
                    }
                }, 5000);
            </script>
        {% endif %}
        {% endwith %}
    </v-layout>
</v-app>
<script src="/static/js/vue.min.js"></script>
<script src="/static/js/config.js"></script>
<script src="/static/js/vuetify.min.js"></script>
<script src="/static/js/axios.min.js"></script>


<script>
    // Base layout mixin for all pages
    const layoutMixin = {
        data() {
            return {
                drawer: true,
                isMobile: window.innerWidth < 960
            };
        },
        methods: {
            handleResize() {
                this.isMobile = window.innerWidth < 960;
            }
        },
        mounted() {
            window.addEventListener('resize', this.handleResize);
        },
        beforeUnmount() {
            window.removeEventListener('resize', this.handleResize);
        }
    };
</script>

{% block js %}{% endblock %}
</body>
</html>
